<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自主编号预选</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        select,
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus,
        input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .number-preview {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            margin: 25px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 2px dashed #3498db;
            color: #2c3e50;
            letter-spacing: 3px;
            background-image: linear-gradient(45deg, #f8f9fa 25%, transparent 25%, transparent 75%, #f8f9fa 75%, #f8f9fa),
                linear-gradient(45deg, #f8f9fa 25%, transparent 25%, transparent 75%, #f8f9fa 75%, #f8f9fa);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            flex: 1;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        #clear-btn {
            background-color: #e67e22;
        }

        #clear-btn:hover {
            background-color: #d35400;
        }

        .saved-list {
            margin-top: 30px;
        }

        .saved-list h2 {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .plate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2px 8px;
            border-bottom: 1px solid #eee;
            background-color: #f8f9fa;
            margin-bottom: 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .plate-item:hover {
            background-color: #e9ecef;
        }

        .plate-number {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .remove-btn {
            background-color: #e74c3c;
            padding: 6px 12px;
            font-size: 14px;
            width: auto;
        }

        .remove-btn:hover {
            background-color: #c0392b;
        }

        .empty-message {
            text-align: center;
            color: #7f8c8d;
            padding: 20px;
            font-style: italic;
        }

        .message {
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
            text-align: center;
            display: none;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 600px) {
            .input-group {
                flex-direction: column;
                gap: 10px;
            }

            .form-group {
                min-width: 100%;
            }

            .number-preview {
                font-size: 24px;
                padding: 15px;
            }

            .button-group {
                flex-direction: row;
            }

            .plate-item {
                flex-direction: row;
                align-items: flex-start;
            }

            .remove-btn {
                width: 120px;
                flex: none;
            }
        }

        .info-text {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="message" class="message"></div>

        <div class="input-group">
            <div class="form-group">
                <label for="prefix-select">选择号段前缀</label>
                <select id="prefix-select">
                    <option value="">请选择号段前缀</option>
                </select>
                <div class="info-text">从可用号段中选择前缀</div>
            </div>

            <div class="form-group">
                <label for="suffix-input">输入后两位数字</label>
                <input type="text" id="suffix-input" maxlength="2" placeholder="输入后两位数字 (00-99)">
                <div class="info-text">请输入两位数字 (00-99)</div>
            </div>
        </div>

        <div class="number-preview" id="number-preview">
            选择号段+后两位数字
        </div>

        <div class="button-group">
            <button id="save-btn" disabled>保存号码</button>
            <button id="clear-btn">清空输入</button>
        </div>

        <div class="saved-list">
            <h2>已保存的号码</h2>
            <div id="saved-numbers">
                <div class="empty-message">暂无保存的号码</div>
            </div>
        </div>
    </div>

    <script>
        // 页面元素
        const prefixSelect = document.getElementById('prefix-select');
        const suffixInput = document.getElementById('suffix-input');
        const numberPreview = document.getElementById('number-preview');
        const saveBtn = document.getElementById('save-btn');
        const clearBtn = document.getElementById('clear-btn');
        const savedNumbers = document.getElementById('saved-numbers');
        const messageDiv = document.getElementById('message');

        // 全局变量
        const base_url = 'https://qinxin.xyz:8009'; // 后端接口地址
        let availablePrefixes = [];
        let savedPlates = [];

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function () {
            loadAvailablePrefixes();
            loadSavedPlates();
            // debugger;

            // 监听输入变化
            prefixSelect.addEventListener('change', updatePreview);
            suffixInput.addEventListener('input', updatePreview);

            // 保存按钮点击事件
            saveBtn.addEventListener('click', savePlateNumber);

            // 清空按钮点击事件
            clearBtn.addEventListener('click', clearInput);
        });

        // 加载可选号段
        async function loadAvailablePrefixes() {
            try {
                // 模拟从后端获取数据 
                // 实际使用时请取消注释以下代码，并注释掉上面的mockData
                const response = await fetch(`${base_url}/get_plate_number`)
                const data = await response.json();

                if (data && data.list) {
                    availablePrefixes = data.list;

                    // 清空现有选项
                    prefixSelect.innerHTML = '<option value="">请选择号段前缀</option>';

                    // 添加新选项
                    data.list.forEach(item => {
                        // 提取前缀部分 (例如从 "闽DFE7700 ~ DFE7799" 提取 "闽DFE77")
                        const prefix = item.split(' ')[0].slice(0, -2);
                        const option = document.createElement('option');
                        option.value = prefix;
                        option.textContent = prefix;
                        prefixSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('获取号段失败:', error);
                showMessage('获取号段失败，请刷新页面重试', 'error');
            }
        }

        // 更新号码预览
        function updatePreview() {
            const prefix = prefixSelect.value;
            let suffix = suffixInput.value;

            // 只允许输入数字
            suffix = suffix.replace(/\D/g, '');
            suffixInput.value = suffix;

            // 验证后缀是否为两位数字
            const isValidSuffix = /^\d{2}$/.test(suffix);

            if (prefix && isValidSuffix) {
                numberPreview.textContent = prefix + suffix;
                saveBtn.disabled = false;
            } else {
                numberPreview.textContent = '选择号段+后两位数字';
                saveBtn.disabled = true;
            }
        }

        // 清空输入
        function clearInput() {
            prefixSelect.value = '';
            suffixInput.value = '';
            updatePreview();
            showMessage('输入已清空', 'success');
        }

        // 保存号码
        async function savePlateNumber() {
            const plateNumber = numberPreview.textContent;

            // 检查是否已保存
            if (savedPlates.includes(plateNumber)) {
                showMessage('该号码已保存', 'error');
                return;
            }

            try {
                // 实际使用时请取消注释以下代码，并注释掉上面的mockData
                const response = await fetch(`${base_url}/add_choice_plate_number?plate_number=${encodeURIComponent(plateNumber)}`);
                const data = await response.json();

                if (data && data.list) {
                    savedPlates = data.list;
                    renderSavedPlates();
                    showMessage('号码保存成功', 'success');

                    // 清空输入
                    clearInput();
                }
            } catch (error) {
                console.error('保存号码失败:', error);
                showMessage('保存号码失败，请重试', 'error');
            }
        }

        // 移除号码
        async function removePlateNumber(plateNumber) {
            try {
                const response = await fetch(`${base_url}/remove_choice_plate_number?plate_number=${encodeURIComponent(plateNumber)}`);
                const data = await response.json();

                if (data && data.list) {
                    savedPlates = data.list;
                    renderSavedPlates();
                    showMessage('号码移除成功', 'success');
                }
            } catch (error) {
                console.error('移除号码失败:', error);
                showMessage('移除号码失败，请重试', 'error');
            }
        }

        // 加载已保存的号码
        async function loadSavedPlates() {
            try {
                const response = await fetch(`${base_url}/add_choice_plate_number`);
                const data = await response.json();

                if (data && data.list) {
                    savedPlates = data.list;
                    renderSavedPlates();
                }
            } catch (error) {
                console.error('加载已保存号码失败:', error);
                // 如果失败，我们假设没有保存的号码
                savedPlates = [];
            }
        }

        // 渲染已保存的号码列表
        function renderSavedPlates() {
            savedNumbers.innerHTML = '';

            if (savedPlates.length === 0) {
                savedNumbers.innerHTML = '<div class="empty-message">暂无保存的号码</div>';
                return;
            }

            savedPlates.forEach((plate, index) => {
                const plateItem = document.createElement('div');
                plateItem.className = 'plate-item';

                const plateNumber = document.createElement('div');
                plateNumber.className = 'plate-number';
                plateNumber.textContent = `${index + 1})${plate}`;

                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = '移除';
                removeBtn.addEventListener('click', () => removePlateNumber(plate));

                plateItem.appendChild(plateNumber);
                plateItem.appendChild(removeBtn);
                savedNumbers.appendChild(plateItem);
            });
        }

        // 显示消息
        function showMessage(text, type) {
            // messageDiv.textContent = text;
            // messageDiv.className = `message ${type}`;
            // messageDiv.style.display = 'block';

            // // 3秒后隐藏消息
            // setTimeout(() => {
            //     messageDiv.style.display = 'none';
            // }, 3000);
        }
    </script>
</body>

</html>